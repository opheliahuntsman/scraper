# NordVPN Integration Guide

This guide explains how to use NordVPN with the SmartFrame scraper's proxy rotation feature.

## Overview

NordVPN offers SOCKS5 and HTTP proxy support, allowing you to integrate their network with the scraper's built-in proxy rotation system.

## Prerequisites

- Active NordVPN subscription
- NordVPN account credentials

## Getting Proxy Credentials

### Method 1: NordVPN Account Dashboard

1. **Log in to NordVPN**
   - Go to https://my.nordaccount.com/
   - Sign in with your account

2. **Access Service Credentials**
   - Navigate to "Services" section
   - Look for "NordVPN"
   - Find "Manual Setup" or "Service credentials"
   - Note down your service credentials (different from login credentials)

3. **Service Credentials Format**
   - **Username**: Service username (usually starts with letters/numbers)
   - **Password**: Service password (generated by NordVPN)
   - These are NOT your NordVPN account login credentials

### Method 2: NordVPN App

1. Open NordVPN application
2. Go to Settings â†’ Advanced
3. Look for "SOCKS5 Proxy" or "Manual Setup"
4. Copy the service credentials shown

## NordVPN Proxy Servers

NordVPN provides proxy servers optimized for different use cases:

### SOCKS5 Proxies (Recommended)

**Server Address**: `proxy.nordvpn.com` (auto-selects best server)

```
# Format: socks5://username:password@server:port

# Auto-select (recommended)
socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080

# Specific country proxies
socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080
socks5://yourserviceuser:yourservicepass@uk.nordvpn.com:1080
socks5://yourserviceuser:yourservicepass@nl.nordvpn.com:1080
```

### HTTP Proxies (Alternative)

```
# Format: http://username:password@server:port

http://yourserviceuser:yourservicepass@proxy.nordvpn.com:80
```

## Available Server Locations

NordVPN has 5000+ servers in 60+ countries. Common country codes:

| Country | Code | Server Address |
|---------|------|----------------|
| United States | us | us.nordvpn.com |
| United Kingdom | uk | uk.nordvpn.com |
| Canada | ca | ca.nordvpn.com |
| Germany | de | de.nordvpn.com |
| France | fr | fr.nordvpn.com |
| Netherlands | nl | nl.nordvpn.com |
| Switzerland | ch | ch.nordvpn.com |
| Sweden | se | se.nordvpn.com |
| Japan | jp | jp.nordvpn.com |
| Australia | au | au.nordvpn.com |
| Singapore | sg | sg.nordvpn.com |

**Note**: For optimal performance, use `proxy.nordvpn.com` which auto-selects the best server.

Full server list: https://nordvpn.com/servers/tools/

## Configuration

### Single Proxy Setup (Recommended for Testing)

```bash
# Auto-select best NordVPN proxy server
PROXY_LIST="socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080"
```

### Multiple Proxy Rotation

For better distribution, use multiple country-specific proxies:

```bash
# Multiple countries for rotation
PROXY_LIST="socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@uk.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@de.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@nl.nordvpn.com:1080"
```

### Replit Configuration

1. Click the **Lock icon** ðŸ”’ (Secrets) in Replit
2. Add new secret:
   - **Key**: `PROXY_LIST`
   - **Value**: Your NordVPN proxy string
3. Example value:
   ```
   socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080
   ```
4. Restart your application

### Docker Configuration

```bash
docker run -e PROXY_LIST="socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080" your-image
```

### Local Development (.env file)

Create or edit `.env` file in project root:

```bash
# NordVPN SOCKS5 Proxies
PROXY_LIST=socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080

# Or multiple countries for rotation
# PROXY_LIST=socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@uk.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@de.nordvpn.com:1080
```

## Testing Your Configuration

### 1. Test Proxy Connectivity

```bash
# Test SOCKS5 proxy with curl
curl --socks5 yourserviceuser:yourservicepass@proxy.nordvpn.com:1080 https://api.ipify.org?format=json

# Expected output: Shows NordVPN proxy IP address
```

### 2. Verify Location

```bash
# Check which country your proxy IP is from
curl --socks5 yourserviceuser:yourservicepass@proxy.nordvpn.com:1080 https://ipapi.co/json/
```

### 3. Verify in Scraper

Run a small test scrape (5-10 images) and check logs:

```
[Scraper] Using proxy: socks5=proxy.nordvpn.com:1080
[ProxyManager] Loaded 1 proxies from environment
[Scraper] Proxy authentication configured for main page
```

## Recommended Configuration

### For Small Jobs (<50 images)
```bash
# Single auto-select proxy
PROXY_LIST="socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080"
```

### For Medium Jobs (50-500 images)
```bash
# 2-3 specific countries
PROXY_LIST="socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@uk.nordvpn.com:1080"
```

### For Large Jobs (>500 images)
```bash
# 4-6 countries across different continents
PROXY_LIST="socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@uk.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@de.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@jp.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@au.nordvpn.com:1080"
```

## Advanced Configuration

### P2P-Optimized Servers

For better performance on data-intensive tasks, use P2P-optimized servers:

```bash
# P2P servers (faster for bulk data)
PROXY_LIST="socks5://yourserviceuser:yourservicepass@nl.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@ca.nordvpn.com:1080"
```

NordVPN's P2P servers: Netherlands, Canada, Sweden, Switzerland, etc.

### Obfuscated Servers

For enhanced privacy (if needed):

```bash
# Use specific obfuscated server locations
PROXY_LIST="socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080"
```

## Troubleshooting

### Authentication Failed
- **Problem**: `407 Proxy Authentication Required` or authentication errors
- **Solutions**:
  1. Verify you're using **service credentials**, not account login
  2. Get credentials from https://my.nordaccount.com/ â†’ Services â†’ NordVPN
  3. Regenerate service credentials if needed
  4. URL-encode special characters in password (`@` â†’ `%40`, `:` â†’ `%3A`)

### Connection Timeout
- **Problem**: Proxy connection times out
- **Solutions**:
  1. Check NordVPN service status: https://nordvpn.com/status/
  2. Try `proxy.nordvpn.com` instead of country-specific
  3. Verify your subscription is active
  4. Try different server location

### Proxy Keeps Getting Marked Unhealthy
- **Problem**: Logs show "Proxy marked as unhealthy"
- **Solutions**:
  1. Use `proxy.nordvpn.com` (auto-selects best server)
  2. Check NordVPN server status
  3. Verify service credentials haven't expired
  4. Reduce concurrent connections (use concurrency: 2-3)

### Still Getting Rate Limited
- **Problem**: Rate limiting despite using NordVPN
- **Solutions**:
  1. Add more country proxies to rotation
  2. Increase delays between requests
  3. Use P2P-optimized servers (nl, ca, se, ch)
  4. Spread across different continents

### Invalid Credentials Error
- **Problem**: Credentials keep failing
- **Solutions**:
  1. **Common mistake**: Using account password instead of service password
  2. Go to https://my.nordaccount.com/ â†’ Services â†’ Manual Setup
  3. Copy service username and password exactly
  4. Regenerate credentials if needed

## Performance Tips

1. **Use Auto-Select**: `proxy.nordvpn.com` automatically picks the fastest server
2. **P2P Servers**: Netherlands and Canada servers are optimized for bulk data
3. **Geographic Distribution**: Mix US, EU, and Asia servers for global coverage
4. **Monitor Latency**: Check logs for connection times
5. **Limit Concurrency**: Use 2-5 concurrent connections with proxies

## Security Best Practices

- âœ… SOCKS5 provides encrypted tunnel to NordVPN
- âœ… Service credentials separate from account login
- âœ… Store credentials in environment variables only
- âœ… Never commit credentials to version control
- âœ… Use Replit Secrets or similar for production
- âœ… Regenerate service credentials periodically

## NordVPN Features

| Feature | Available | Notes |
|---------|-----------|-------|
| SOCKS5 Proxy | âœ… Yes | Recommended |
| HTTP Proxy | âœ… Yes | Alternative option |
| Auto-server selection | âœ… Yes | Use proxy.nordvpn.com |
| Country-specific | âœ… Yes | 60+ countries |
| P2P optimization | âœ… Yes | Faster for bulk data |
| Unlimited bandwidth | âœ… Yes | No data caps |

## Comparison: Auto vs Country-Specific

### Auto-Select (proxy.nordvpn.com)
**Pros:**
- Automatically selects fastest server
- Simplest configuration
- Best for single proxy setup

**Cons:**
- Limited rotation (always same server)
- Can't control geographic distribution

### Country-Specific Proxies
**Pros:**
- Geographic diversity
- Better rotation across IPs
- Control over locations

**Cons:**
- Must manage multiple servers
- Some servers may be slower
- More complex configuration

**Recommendation**: Start with auto-select, add country-specific if you need more rotation.

## Support Resources

- **NordVPN Help**: https://support.nordvpn.com/
- **Service Credentials**: https://my.nordaccount.com/dashboard/nordvpn/manual-setup
- **Server Status**: https://nordvpn.com/servers/tools/
- **SOCKS5 Setup Guide**: https://support.nordvpn.com/Connectivity/Proxy/1087802472/Proxy-setup-on-macOS.htm

## Cost Considerations

| Plan | Price (approx) | Proxy Access |
|------|----------------|--------------|
| 1 Month | ~$12/mo | âœ… Full access |
| 1 Year | ~$5/mo | âœ… Full access |
| 2 Years | ~$3/mo | âœ… Full access |

**Note**: All plans include full proxy access. Longer plans offer better value.

## Summary

NordVPN integration steps:
1. âœ… Get service credentials from NordVPN dashboard (NOT account password)
2. âœ… Set `PROXY_LIST` with SOCKS5 format
3. âœ… Start with `proxy.nordvpn.com` for auto-selection
4. âœ… Add country-specific servers for better rotation
5. âœ… Monitor logs for health status

### Quick Start Example

```bash
# Simplest configuration (recommended for getting started)
PROXY_LIST="socks5://yourserviceuser:yourservicepass@proxy.nordvpn.com:1080"

# Advanced rotation (for large jobs)
PROXY_LIST="socks5://yourserviceuser:yourservicepass@us.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@uk.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@de.nordvpn.com:1080,socks5://yourserviceuser:yourservicepass@nl.nordvpn.com:1080"
```

That's it! The scraper will automatically rotate through your NordVPN proxies with health monitoring and automatic failover.
